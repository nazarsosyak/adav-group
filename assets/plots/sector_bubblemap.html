<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sector Bubblemap</title>

<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>

<style>
:root{
  --bg:#0b0d12;
  --fg:#e8e8e8;
  --muted:#9aa0a6;
  --panel:#12151c;
}

html,body{
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--fg);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}

#wrap{
  width:100%;
  height:100%;
  display:flex;
  flex-direction:column;
}

#top{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:10px 14px;
  font-size:13px;
  border-bottom:1px solid rgba(255,255,255,.08);
}

#back{
  background:none;
  border:1px solid rgba(255,255,255,.15);
  color:var(--fg);
  padding:6px 10px;
  border-radius:12px;
  cursor:pointer;
  font-size:12px;
  opacity:.5;
}
#back.enabled{opacity:1}

svg{
  flex:1;
  width:100%;
  height:100%;
}

text{
  fill:var(--fg);
  pointer-events:none;
  text-anchor:middle;
  dominant-baseline:middle;
  font-size:11px;
}
</style>
</head>

<body>
<div id="wrap">
  <div id="top">
    <div id="title">Sector overview</div>
    <button id="back">← Back</button>
  </div>
  <svg id="svg"></svg>
</div>

<script>
/* ============================================================
   DATA — sectors + popular tickers (static, no CSV)
   ============================================================ */

const SECTORS = [
  { name:"Basic Materials", color:"#8dd3c7", tickers:["LIN","SHW","APD","ECL","FCX","NEM","DOW","DD","PPG","IFF","VMC","MLM","ALB","CF","MOS","NUE","STLD","X","RIO","BHP"] },
  { name:"Consumer Discretionary", color:"#fb8072", tickers:["AMZN","TSLA","HD","MCD","NKE","LOW","BKNG","SBUX","GM","F","ROST","TJX","CMG","MAR","HLT","EBAY","YUM","LULU","AZO","ORLY"] },
  { name:"Consumer Staples", color:"#80b1d3", tickers:["WMT","PG","COST","KO","PEP","MDLZ","CL","MO","PM","KMB","GIS","KHC","SYY","KR","HSY","EL","CPB","STZ","TAP","WBA"] },
  { name:"Energy", color:"#fdb462", tickers:["XOM","CVX","SHEL","BP","COP","EOG","SLB","HAL","PSX","VLO","MPC","OXY","KMI","WMB","BKR","DVN","FANG","APA","HES","EQT"] },
  { name:"Finance", color:"#b3de69", tickers:["JPM","BAC","WFC","GS","MS","C","AXP","V","MA","BRK.B","SCHW","BLK","SPGI","ICE","AIG","PNC","USB","TFC","COF","BK"] },
  { name:"Health Care", color:"#fccde5", tickers:["UNH","JNJ","LLY","PFE","MRK","ABBV","TMO","ABT","DHR","AMGN","GILD","BMY","VRTX","ISRG","REGN","MDT","CI","CVS","ELV","HUM"] },
  { name:"Industrials", color:"#d9d9d9", tickers:["BA","CAT","GE","RTX","LMT","DE","MMM","HON","UPS","FDX","NOC","ETN","EMR","CSX","NSC","WM","ROP","ITW","PCAR","FAST"] },
  { name:"Miscellaneous", color:"#bc80bd", tickers:["META","GOOG","NFLX","UBER","SPOT","SNAP","TWLO","ROKU","ZM","PINS","DOCU","SQ","SHOP","DASH","PLTR","RBLX","COIN","LYFT","AFRM","HOOD"] },
  { name:"Real Estate", color:"#ccebc5", tickers:["AMT","PLD","CCI","EQIX","SPG","PSA","O","DLR","VTR","WELL","AVB","EQR","ARE","IRM","ESS","MAA","UDR","BXP","KIM","REG"] },
  { name:"Technology", color:"#ffed6f", tickers:["AAPL","MSFT","NVDA","GOOG","META","AVGO","ORCL","CRM","ADBE","AMD","INTC","QCOM","TXN","CSCO","AMAT","LRCX","KLAC","SNPS","INTU","NOW"] },
  { name:"Telecommunications", color:"#bebada", tickers:["VZ","T","TMUS","AMX","CHTR","CMCSA","BTI","VOD","TEF","ORAN","TEL","SKM","NTT","KT","LUMN","USM","TELIA","TIM","SJM","MTN"] },
  { name:"Utilities", color:"#ffffb3", tickers:["NEE","DUK","SO","AEP","EXC","SRE","D","XEL","PEG","ED","EIX","PCG","WEC","ES","CMS","PPL","DTE","NRG","AES","IDA"] }
];

/* ============================================================
   PACK LAYOUT + STATE
   ============================================================ */

const svg = d3.select("#svg");
const g = svg.append("g");

const backBtn = document.getElementById("back");
const titleEl = document.getElementById("title");

let width, height, current="sectors";

function resize(){
  const r = svg.node().getBoundingClientRect();
  width = r.width;
  height = r.height;
}
resize();
window.addEventListener("resize", () => { resize(); render(); });

const pack = d3.pack().padding(8);

/* ============================================================
   RENDER FUNCTIONS
   ============================================================ */

function renderSectors(){
  titleEl.textContent = "Sector overview";
  backBtn.classList.remove("enabled");

  const root = d3.hierarchy({children:SECTORS.map(d=>({name:d.name,value:1,color:d.color,data:d}))})
    .sum(d=>d.value);

  pack.size([width,height])(root);

  const nodes = g.selectAll("g").data(root.leaves(), d=>d.data.name);

  nodes.exit().transition().duration(300).style("opacity",0).remove();

  const enter = nodes.enter().append("g")
    .style("cursor","pointer")
    .on("click",(e,d)=>renderTickers(d.data.data));

  enter.append("circle");
  enter.append("text");

  const all = enter.merge(nodes);

  all.transition().duration(600)
    .attr("transform",d=>`translate(${d.x},${d.y})`);

  all.select("circle")
    .transition().duration(600)
    .attr("r",d=>d.r)
    .attr("fill",d=>d.data.color)
    .attr("opacity",0.85);

  all.select("text")
    .text(d=>d.data.name)
    .style("font-size",d=>Math.min(14,d.r/3)+"px");
}

function renderTickers(sector){
  current="tickers";
  titleEl.textContent = sector.name;
  backBtn.classList.add("enabled");

  const root = d3.hierarchy({
    children: sector.tickers.map(t=>({name:t,value:1}))
  }).sum(d=>d.value);

  pack.size([width,height])(root);

  const nodes = g.selectAll("g").data(root.leaves(), d=>d.data.name);

  nodes.exit().transition().duration(300).style("opacity",0).remove();

  const enter = nodes.enter().append("g");
  enter.append("circle");
  enter.append("text");

  const all = enter.merge(nodes);

  all.transition().duration(600)
    .attr("transform",d=>`translate(${d.x},${d.y})`);

  all.select("circle")
    .transition().duration(600)
    .attr("r",d=>d.r)
    .attr("fill",sector.color)
    .attr("opacity",0.9);

  all.select("text")
    .text(d=>d.data.name)
    .style("font-size",d=>Math.min(12,d.r/2)+"px");
}

/* ============================================================
   EVENTS
   ============================================================ */

backBtn.addEventListener("click",()=>{
  if(current==="tickers"){
    current="sectors";
    renderSectors();
  }
});

/* ============================================================
   INIT
   ============================================================ */

renderSectors();
</script>
</body>
</html>
